!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).assetsRetry=e()}(this,function(){"use strict";function i(t){return t}function s(){}function r(t,e){try{return"function"==typeof t[e]}catch(t){return!1}}function l(t){return Array.isArray(t)?t.reduce(function(t,e,n,r){return t[e]=r[(n+1)%r.length],t},{}):t}function d(e,t){return Object.keys(t).filter(function(t){return-1<e.indexOf(t)}).sort(function(t,e){return e.length-t.length})[0]}var e,y="retryTimes",h="succeeded",p="failed",v="maxRetryCount",g="onRetry",c="onSuccess",m="onFail",b="domain",E="_assetsRetryScript",S="_assetsRetryOnerror",u="script",O="data-assets-retry-hooked",w="data-assets-retry-ignore",j="data-retry-id",a=window,A=window.document,n=a.HTMLElement,k=a.HTMLScriptElement,f=a.HTMLStyleElement,L=a.HTMLLinkElement,R=a.HTMLImageElement,o=Object.prototype.hasOwnProperty,T=function(t,e,n){var r=t.indexOf(e);return-1===r?t:t.substring(0,r)+n+t.substring(r+e.length)},x=function(t){return[].slice.call(t)},M=function(e,t,n,r){void 0===n&&(n=s);var o,i,r=(r=void 0===r?!1:r)||e.defer||e.async;"loading"!==A.readyState||/Edge|MSIE|rv:/i.test(navigator.userAgent)||r?(o=A.createElement(u),Object.keys(k.prototype).forEach(function(t){if("src"!==t&&e[t]&&"object"!=typeof e[t])try{o[t]=e[t]}catch(t){}}),o.src=t,o.onload=e.onload,o.onerror=e.onerror,o.setAttribute(j,C()),(i=e.getAttribute("nonce"))&&o.setAttribute("nonce",i),A.getElementsByTagName("head")[0].appendChild(o)):(i=C(),t=e.outerHTML.replace(/data-retry-id="[^"]+"/,"").replace(/src=(?:"[^"]+"|.+)([ >])/,j+"="+i+' src="'+t+'"$1'),A.write(t),(i=A.querySelector("script["+j+'="'+i+'"]'))&&(i.onload=n))},_=function(e){try{return e.rules}catch(t){try{return e.cssRules}catch(t){return null}}},H=function(e,t,n){var r=A.createElement("link");Object.keys(L.prototype).forEach(function(t){if("href"!==t&&e[t]&&"object"!=typeof e[t])try{r[t]=e[t]}catch(t){}}),r.href=t,r.onload=n,r.setAttribute(j,C()),A.getElementsByTagName("head")[0].appendChild(r)},N=function(t){return t?t instanceof n?[t.nodeName,t.src,t.href,t.getAttribute(j)].join(";"):"not_supported":"null"},C=function(){return Math.random().toString(36).slice(2)},I=function(t){return t instanceof k||t instanceof R?t.src:t instanceof L?t.href:null},P={},B=function(t,e){var n=F(t,e),t=n[0],e=n[1];return t?(P[t]=P[t]||((n={})[y]=0,n[p]=[],n[h]=[],n),[e,P[t]]):[]},F=function(t,e){var n=d(t,e);return n?[(e=n,(t=t).substr(t.indexOf(e)+e.length,t.length)),n]:["",""]};try{e=function(t){for(var e=Object.getPrototypeOf||function(t){return t.__proto__},n=Object.keys(t);e(t);)n=n.concat(Object.keys(e(t))),t=e(t);return n.filter(function(t){return"constructor"!==t})}(k.prototype)}catch(t){}function $(c,t){var u=t[v],a=l(t[b]),f=t[g];return e.reduce(function(t,e){var n=r(k.prototype,e);return t[e]=n?{value:function(){return c[E][e].apply(c[E],arguments)}}:{set:function(r){return"onerror"===e?(c[S]=r,void(c[E].onerror=function(r){r.stopPropagation&&r.stopPropagation();function t(){return t=c[S],e=c[E],n=r,"function"!=typeof t?null:t.call(e,n);var t,e,n}var e=c[E].src,n=B(e,a),o=n[0],i=n[1],n=c[E].hasAttribute(w);if(!o||!i||n)return t();o=T(e,o,a[o]),e=f(o,e,i);if(null===e)return t();if("string"!=typeof e)throw new Error("a string should be returned in `onRetry` function");i[y]<=u?M(c[E],e,s,!0):t()})):"onload"===e?(c._assetsRetryOnload=r,void(c[E].onload=function(t){var e=c[E].src,n=B(e,a),n=(n[0],n[1]);n&&-1===n[p].indexOf(e)&&n[h].push(e),r&&!r._called&&(r._called=!0,r.call(c[E],t))})):void(c[E][e]=r)},get:function(){return c[E][e]}},t},{})}var q=function(n){var r=A.createElement;A.createElement=function(t,e){return t===u?function(t,e){t.setAttribute(O,"true");var n=((n={})[E]=t,n[S]=s,n),e=$(n,e);return Object.defineProperties(n,e),n}(r.call(A,u),n):r.call(A,t,e)},A.createElement.toString=function(){return"function createElement() { [native code] }"}},z=function(n){Object.keys(n).filter(function(t){return r(n,t)}).forEach(function(t){var e=n[t];n[t]=function(){var t=[].slice.call(arguments).map(function(t){return t&&(o.call(t,E)?t[E]:t)});return e.apply(this,t)},/^\w+$/.test(t)&&(n[t].toString=new Function("return 'function "+t+"() { [native code] }'"))})};var Z={};function D(u){function o(t){if(t){var e=t.target||t.srcElement,n=I(e);if(n){var r=B(n,s),o=r[0],i=r[1],t=e instanceof HTMLElement&&e.hasAttribute(w);if(i&&o&&!t){i[y]++,i[p].push(n);r=i[y]>u[v];if(r&&(t=F(n,s)[0],f(t)),s[o]&&!r){var r=s[o],r=T(n,o,r),c=a(r,n,i);if(null!==c){if("string"!=typeof c)throw new Error("a string should be returned in `onRetry` function");n=N(e);Z[n]||(Z[n]=!0,n=function(){i[h].push(c)},e instanceof k&&!e.getAttribute(O)&&e.src?M(e,c,n):e instanceof L&&e.href?H(e,c,n):e instanceof R&&e.src&&(e.setAttribute(j,C()),e.src=c,e.onload=n))}}}}}}var a=u[g],i=u[c],f=u[m],s=u[b];A.addEventListener("error",o,!0),A.addEventListener("load",function(t){var e,n,r;t&&(e=t.target||t.srcElement,(n=I(e))&&(e.getAttribute(j)&&(r=F(n,s)[0],i(r)),e instanceof L&&A.styleSheets&&(r=x(A.styleSheets).filter(function(t){return t.href===e.href})[0],null!==(r=_(r))&&0===r.length&&o(t))))},!0)}function G(t,e,n,r,o){var i=o[b],c=o[g],o=e.style&&e.style[t];if(o&&!/^url\(["']?data:/.test(o)){var o=o.match(/^url\(["']?(.+?)["']?\)/)||[],u=(o[0],o[1]);if(u){var a=d(u,i);if(a&&i[a]){var i=Object.keys(i).map(function(t){t=T(u,a,t);return'url("'+c(t,u,null)+'")'}).join(","),f=e.selectorText+("{ "+t.replace(/([a-z])([A-Z])/g,function(t,e,n){return e+"-"+n.toLowerCase()}))+": "+i+" !important; }";try{Q.call(n,f,r.length)}catch(t){Q.call(n,f,0)}}}}}var J={},K=[],Q=a.CSSStyleSheet.prototype.insertRule,U=["backgroundImage","borderImage","listStyleImage"],V=function(t,o){t.forEach(function(n){var r,t=_(n);null!==t&&((r=x(t)).forEach(function(e){U.forEach(function(t){G(t,e,n,r,o)})}),n.href&&(J[n.href]=!0),n.ownerNode instanceof f&&K.push(n.ownerNode))})},W=function(t,e){return x(t).filter(function(t){if(!_(t))return!1;if(t.href)return!J[t.href]&&!!d(t.href,e);t=t.ownerNode;return!(t instanceof f&&-1<K.indexOf(t))&&!(t instanceof f&&!t.innerHTML)})},X=function(i){a.CSSStyleSheet.prototype.insertRule=function(t,e){var n=Q.call(this,t,e),r=this,t=_(r);if(null===t)return n;var o=x(t);return U.forEach(function(t){G(t,o[n],r,o,i)}),e||0}};return function(t){var e,n;void 0===t&&(t={});try{if("object"!=typeof t[b])throw new Error("opts.domain cannot be non-object.");var r=[v,g,c,m,b],o=Object.keys(t).filter(function(t){return-1===r.indexOf(t)});if(0<o.length)throw new Error("option name: "+o.join(", ")+" is not valid.");var o=((o={})[v]=t[v]||3,o[g]=t[g]||i,o[c]=t[c]||s,o[m]=t[m]||s,o[b]=l(t[b]),o);return q(o),"undefined"!=typeof Node&&z(Node.prototype),"undefined"!=typeof Element&&z(Element.prototype),D(o),e=o,o=A.styleSheets,n=e[b],o&&(X(e),setInterval(function(){var t=W(A.styleSheets,n);0<t.length&&V(t,e)},250)),P}catch(t){a.console&&console.error("[assetsRetry] error captured",t)}}});
//# sourceMappingURL=assets-retry.umd.js.map
